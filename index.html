<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohio Property Market Analysis</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè†</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* General Styling & Layout */
        :root {
            --color-primary: #2563eb;
            --color-primary-hover: #1d4ed8;
            --color-danger: #dc2626;
            --color-success: #16a34a;
            --color-warning: #d97706;
            --color-text-dark: #111827;
            --color-text-medium: #4b5563;
            --color-text-light: #6b7280;
            --color-bg-light: #f9fafb;
            --color-bg-white: #ffffff;
            --color-border: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --border-radius: 0.5rem; /* 8px */
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            margin: 0;
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            font-size: 16px;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Card & Box Styling */
        .card {
            background-color: var(--color-bg-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Grid Layout */
        .grid { display: grid; gap: 1.5rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        
        @media (max-width: 768px) {
            .grid-cols-5, .grid-cols-4, .grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }
        .header p {
            color: var(--color-text-light);
            margin: 0;
        }

        /* Forms & Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-bg-white);
        }
        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-medium);
            margin-bottom: 0.5rem;
        }
        
        input, select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 0.375rem;
            box-sizing: border-box;
        }
        
        /* Icons */
        .icon {
            width: 2rem;
            height: 2rem;
            stroke-width: 2;
        }
        .icon-sm {
            width: 1rem;
            height: 1rem;
        }
        .icon-primary { color: var(--color-primary); }
        .icon-success { color: var(--color-success); }
        .icon-warning { color: var(--color-warning); }
        .icon-danger { color: var(--color-danger); }


        /* Stats Cards */
        .stat-card {
            display: flex;
            align-items: center;
        }
        .stat-card .icon { margin-right: 1rem; }
        .stat-card p { margin: 0; }
        .stat-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-light);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Table */
        .table-container { overflow-x: auto; }
        table {
            min-width: 100%;
            border-collapse: collapse;
        }
        thead { background-color: var(--color-bg-light); }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
            white-space: nowrap;
        }
        th {
            font-size: 0.75rem;
            color: var(--color-text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        tbody tr:hover { background-color: var(--color-bg-light); }
        .property-address { font-weight: 500; }
        .property-details { font-size: 0.875rem; color: var(--color-text-light); }
        .view-details-btn { color: var(--color-primary); cursor: pointer; font-weight: 500; }
        .view-details-btn:hover { text-decoration: underline; }

        /* Risk Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.125rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .risk-Low { color: #059669; background-color: #d1fae5; }
        .risk-Medium { color: #d97706; background-color: #fef3c7; }
        .risk-High { color: #dc2626; background-color: #fee2e2; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }
        .modal-content {
            background: var(--color-bg-white);
            border-radius: var(--border-radius);
            max-width: 896px; /* max-w-4xl */
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text-light);
        }
        .detail-card {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }
        .detail-card h3 { margin-top: 0; }
        .detail-card p { margin: 0.25rem 0; font-size: 0.875rem; }
        .detail-card .font-medium { font-weight: 500; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-blue-50 { background-color: #eff6ff; }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .btn-secondary {
            background-color: var(--color-border);
            color: var(--color-text-medium);
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card header">
            <div class="header-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-primary"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <div>
                    <h1>Ohio Property Market Analysis</h1>
                    <p>Distressed Property Investment Tool</p>
                </div>
            </div>
            <button id="export-btn" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-sm"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
                <span>Export Data</span>
            </button>
        </div>

        <div class="card">
            <h2 style="margin-top:0; font-size: 1.125rem;">Search Filters</h2>
            <div class="grid grid-cols-5">
                <div>
                    <label for="county-filter">County</label>
                    <select id="county-filter">
                        <option value="all">All Counties</option>
                        <option value="Mahoning">Mahoning</option>
                        <option value="Franklin">Franklin</option>
                        <option value="Hamilton">Hamilton</option>
                        <option value="Cuyahoga">Cuyahoga</option>
                        <option value="Lucas">Lucas</option>
                    </select>
                </div>
                <div>
                    <label for="delinquency-filter">Min Delinquency</label>
                    <input type="number" id="delinquency-filter" value="0" step="1000">
                </div>
                <div>
                    <label for="price-filter">Max Price</label>
                    <input type="number" id="price-filter" value="500000" step="10000">
                </div>
                <div>
                    <label for="type-filter">Property Type</label>
                    <select id="type-filter">
                        <option value="all">All Types</option>
                        <option value="Single Family">Single Family</option>
                    </select>
                </div>
                <div>
                    <label for="bedrooms-filter">Bedrooms</label>
                    <select id="bedrooms-filter">
                        <option value="all">Any</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5+</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2">
            <div class="card">
                <h2 style="margin-top:0; font-size: 1.125rem;">Market Price Trends</h2>
                <canvas id="price-chart"></canvas>
            </div>
            <div class="card">
                <h2 style="margin-top:0; font-size: 1.125rem;">Foreclosure Activity</h2>
                <canvas id="foreclosure-chart"></canvas>
            </div>
        </div>

        <div class="grid grid-cols-4">
            <div class="card stat-card">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-primary"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <div>
                    <p class="stat-label">Total Properties</p>
                    <p id="total-properties" class="stat-value">0</p>
                </div>
            </div>
            <div class="card stat-card">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-success"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                <div>
                    <p class="stat-label">Avg Wholesale Price</p>
                    <p id="avg-wholesale" class="stat-value">$0</p>
                </div>
            </div>
            <div class="card stat-card">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" style="color: #9333ea;"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>
                <div>
                    <p class="stat-label">Avg ROI</p>
                    <p id="avg-roi" class="stat-value">0%</p>
                </div>
            </div>
            <div class="card stat-card">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-danger"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" x2="12" y1="9" y2="13"></line><line x1="12" x2="12.01" y1="17" y2="17"></line></svg>
                <div>
                    <p class="stat-label">High Risk Properties</p>
                    <p id="high-risk" class="stat-value">0</p>
                </div>
            </div>
        </div>
        
        <div class="card" style="padding:0; overflow:hidden;">
            <div style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--color-border);">
                <h2 id="properties-title" style="margin:0; font-size: 1.125rem;">Distressed Properties (0)</h2>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Delinquency</th>
                            <th>Investment</th>
                            <th>ROI</th>
                            <th>Risk</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="property-table-body">
                        </tbody>
                </table>
            </div>
        </div>

    </div> <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content">
            </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- DATA ---
        // In a real app, this would be fetched from a server/API
        const sampleProperties = [
            { id: 1, address: '123 Main St, Youngstown, OH', county: 'Mahoning', propertyType: 'Single Family', bedrooms: 3, bathrooms: 2, sqft: 1200, lotSize: 0.25, yearBuilt: 1985, currentValue: 85000, taxDelinquency: 4500, mortgageDelinquency: 12000, monthsDelinquent: 8, foreclosureStage: 'Pre-foreclosure', distanceToDowntown: 2.5, marketScore: 72, riskLevel: 'Medium', estimatedRepairCost: 15000, afterRepairValue: 110000, wholesalePrice: 55000, retailPrice: 95000 },
            { id: 2, address: '456 Oak Ave, Columbus, OH', county: 'Franklin', propertyType: 'Single Family', bedrooms: 4, bathrooms: 2, sqft: 1800, lotSize: 0.35, yearBuilt: 1978, currentValue: 145000, taxDelinquency: 8200, mortgageDelinquency: 22000, monthsDelinquent: 12, foreclosureStage: 'Foreclosure', distanceToDowntown: 4.2, marketScore: 85, riskLevel: 'High', estimatedRepairCost: 25000, afterRepairValue: 180000, wholesalePrice: 95000, retailPrice: 135000 },
            { id: 3, address: '789 Pine Rd, Cincinnati, OH', county: 'Hamilton', propertyType: 'Single Family', bedrooms: 3, bathrooms: 1, sqft: 1100, lotSize: 0.20, yearBuilt: 1962, currentValue: 75000, taxDelinquency: 2800, mortgageDelinquency: 8500, monthsDelinquent: 6, foreclosureStage: 'Pre-foreclosure', distanceToDowntown: 3.8, marketScore: 68, riskLevel: 'Low', estimatedRepairCost: 12000, afterRepairValue: 95000, wholesalePrice: 48000, retailPrice: 72000 },
            { id: 4, address: '321 Elm St, Cleveland, OH', county: 'Cuyahoga', propertyType: 'Single Family', bedrooms: 2, bathrooms: 1, sqft: 900, lotSize: 0.15, yearBuilt: 1955, currentValue: 65000, taxDelinquency: 5400, mortgageDelinquency: 15000, monthsDelinquent: 10, foreclosureStage: 'Foreclosure', distanceToDowntown: 5.1, marketScore: 58, riskLevel: 'High', estimatedRepairCost: 18000, afterRepairValue: 85000, wholesalePrice: 42000, retailPrice: 62000 },
            { id: 5, address: '654 Maple Dr, Toledo, OH', county: 'Lucas', propertyType: 'Single Family', bedrooms: 3, bathrooms: 2, sqft: 1350, lotSize: 0.28, yearBuilt: 1992, currentValue: 95000, taxDelinquency: 3200, mortgageDelinquency: 6000, monthsDelinquent: 4, foreclosureStage: 'Pre-foreclosure', distanceToDowntown: 1.8, marketScore: 78, riskLevel: 'Low', estimatedRepairCost: 8000, afterRepairValue: 115000, wholesalePrice: 68000, retailPrice: 88000 }
        ];

        const marketTrendData = [
            { month: 'Jan 2024', avgPrice: 89000, foreclosures: 45, sales: 120 },
            { month: 'Feb 2024', avgPrice: 91000, foreclosures: 52, sales: 115 },
            { month: 'Mar 2024', avgPrice: 88000, foreclosures: 48, sales: 135 },
            { month: 'Apr 2024', avgPrice: 92000, foreclosures: 41, sales: 128 },
            { month: 'May 2024', avgPrice: 94000, foreclosures: 38, sales: 142 },
            { month: 'Jun 2024', avgPrice: 96000, foreclosures: 35, sales: 155 }
        ];

        // --- DOM ELEMENTS ---
        const filterElements = {
            county: document.getElementById('county-filter'),
            minDelinquency: document.getElementById('delinquency-filter'),
            maxPrice: document.getElementById('price-filter'),
            propertyType: document.getElementById('type-filter'),
            bedrooms: document.getElementById('bedrooms-filter')
        };
        
        const statElements = {
            totalProperties: document.getElementById('total-properties'),
            avgWholesale: document.getElementById('avg-wholesale'),
            avgRoi: document.getElementById('avg-roi'),
            highRisk: document.getElementById('high-risk')
        };
        
        const tableBody = document.getElementById('property-table-body');
        const propertiesTitle = document.getElementById('properties-title');
        const exportBtn = document.getElementById('export-btn');

        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');

        // --- HELPER FUNCTIONS ---
        const formatCurrency = (num) => `$${num.toLocaleString()}`;
        const calculateROI = (p) => {
            const totalInvestment = p.wholesalePrice + p.estimatedRepairCost;
            if (totalInvestment === 0) return 0;
            const profit = p.afterRepairValue - totalInvestment;
            return ((profit / totalInvestment) * 100).toFixed(1);
        };

        // --- STATE & RENDER LOGIC ---
        let currentFilters = {
            county: 'all',
            minDelinquency: 0,
            maxPrice: 500000,
            propertyType: 'all',
            bedrooms: 'all'
        };
        let filteredProperties = [];

        function updateFilters() {
            currentFilters.county = filterElements.county.value;
            currentFilters.minDelinquency = parseInt(filterElements.minDelinquency.value) || 0;
            currentFilters.maxPrice = parseInt(filterElements.maxPrice.value) || 9999999;
            currentFilters.propertyType = filterElements.propertyType.value;
            currentFilters.bedrooms = filterElements.bedrooms.value;
            render();
        }

        function render() {
            // 1. Filter properties
            filteredProperties = sampleProperties.filter(p => {
                const totalDelinquency = p.taxDelinquency + p.mortgageDelinquency;
                return (
                    (currentFilters.county === 'all' || p.county === currentFilters.county) &&
                    totalDelinquency >= currentFilters.minDelinquency &&
                    p.currentValue <= currentFilters.maxPrice &&
                    (currentFilters.propertyType === 'all' || p.propertyType === currentFilters.propertyType) &&
                    (currentFilters.bedrooms === 'all' || p.bedrooms.toString() === currentFilters.bedrooms)
                );
            });

            // 2. Update stats
            const total = filteredProperties.length;
            statElements.totalProperties.textContent = total;
            propertiesTitle.textContent = `Distressed Properties (${total})`;
            
            if (total > 0) {
                const avgWholesale = filteredProperties.reduce((sum, p) => sum + p.wholesalePrice, 0) / total;
                statElements.avgWholesale.textContent = formatCurrency(Math.round(avgWholesale));

                const avgRoi = filteredProperties.reduce((sum, p) => sum + parseFloat(calculateROI(p)), 0) / total;
                statElements.avgRoi.textContent = `${avgRoi.toFixed(1)}%`;
                
                const highRiskCount = filteredProperties.filter(p => p.riskLevel === 'High').length;
                statElements.highRisk.textContent = highRiskCount;
            } else {
                statElements.avgWholesale.textContent = '$0';
                statElements.avgRoi.textContent = '0%';
                statElements.highRisk.textContent = '0';
            }

            // 3. Render table
            tableBody.innerHTML = ''; // Clear existing rows
            if (filteredProperties.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; color: var(--color-text-light); padding: 2rem;">No properties match the current filters.</td></tr>`;
            } else {
                 filteredProperties.forEach(p => {
                    const roi = calculateROI(p);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="property-address">${p.address}</div>
                            <div class="property-details">${p.bedrooms}BR/${p.bathrooms}BA ‚Ä¢ ${p.sqft} sqft ‚Ä¢ ${p.county} County</div>
                        </td>
                        <td>
                            <div>Tax: ${formatCurrency(p.taxDelinquency)}</div>
                            <div class="property-details">Mortgage: ${formatCurrency(p.mortgageDelinquency)}</div>
                        </td>
                        <td>
                            <div>Wholesale: ${formatCurrency(p.wholesalePrice)}</div>
                            <div class="property-details">Repairs: ${formatCurrency(p.estimatedRepairCost)}</div>
                        </td>
                        <td><div style="color:var(--color-success); font-weight:500;">${roi}%</div></td>
                        <td><span class="badge risk-${p.riskLevel}">${p.riskLevel}</span></td>
                        <td><span class="view-details-btn" data-id="${p.id}">View Details</span></td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // --- MODAL LOGIC ---
        function showModal(propertyId) {
            const property = sampleProperties.find(p => p.id === propertyId);
            if (!property) return;

            modalContent.innerHTML = `
                <div class="modal-header">
                    <div>
                        <h2 style="margin:0; font-size:1.5rem;">${property.address}</h2>
                        <p style="margin:0; color:var(--color-text-light);">${property.county} County, Ohio</p>
                    </div>
                    <button id="modal-close" class="modal-close-btn">&times;</button>
                </div>
                <div class="grid grid-cols-2">
                    <div class="space-y-4">
                        <div class="detail-card bg-gray-50">
                            <h3 class="font-semibold">Property Details</h3>
                            <p><span class="font-medium">Type:</span> ${property.propertyType}</p>
                            <p><span class="font-medium">Specs:</span> ${property.bedrooms} BR / ${property.bathrooms} BA</p>
                            <p><span class="font-medium">Square Feet:</span> ${property.sqft.toLocaleString()} sqft</p>
                            <p><span class="font-medium">Lot Size:</span> ${property.lotSize} acres</p>
                            <p><span class="font-medium">Year Built:</span> ${property.yearBuilt}</p>
                            <p><span class="font-medium">Distance to Downtown:</span> ${property.distanceToDowntown} miles</p>
                        </div>
                        <div class="detail-card bg-red-50">
                            <h3 class="font-semibold">Delinquency Information</h3>
                            <p><span class="font-medium">Tax Delinquency:</span> ${formatCurrency(property.taxDelinquency)}</p>
                            <p><span class="font-medium">Mortgage Delinquency:</span> ${formatCurrency(property.mortgageDelinquency)}</p>
                            <p><span class="font-medium">Months Delinquent:</span> ${property.monthsDelinquent}</p>
                            <p><span class="font-medium">Foreclosure Stage:</span> ${property.foreclosureStage}</p>
                        </div>
                    </div>
                     <div class="space-y-4">
                        <div class="detail-card bg-green-50">
                            <h3 class="font-semibold">Investment Analysis</h3>
                            <p><span class="font-medium">Current Value:</span> ${formatCurrency(property.currentValue)}</p>
                            <p><span class="font-medium">Wholesale Price:</span> ${formatCurrency(property.wholesalePrice)}</p>
                            <p><span class="font-medium">Retail Price:</span> ${formatCurrency(property.retailPrice)}</p>
                            <p><span class="font-medium">Estimated Repairs:</span> ${formatCurrency(property.estimatedRepairCost)}</p>
                            <p><span class="font-medium">After Repair Value (ARV):</span> ${formatCurrency(property.afterRepairValue)}</p>
                            <p><span class="font-medium">Projected ROI:</span> <span style="color:var(--color-success); font-weight:700;">${calculateROI(property)}%</span></p>
                        </div>
                        <div class="detail-card bg-blue-50">
                            <h3 class="font-semibold">Market Scoring</h3>
                            <p><span class="font-medium">Market Score:</span> ${property.marketScore}/100</p>
                            <p><span class="font-medium">Risk Level:</span> <span class="badge risk-${property.riskLevel}">${property.riskLevel}</span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="modal-close-footer" class="btn btn-secondary">Close</button>
                    <button class="btn btn-primary">Generate Report</button>
                </div>
            `;
            modalOverlay.classList.add('active');
            document.getElementById('modal-close').addEventListener('click', hideModal);
            document.getElementById('modal-close-footer').addEventListener('click', hideModal);
        }

        function hideModal() {
            modalOverlay.classList.remove('active');
        }

        // --- CHARTING LOGIC ---
        function setupCharts() {
            const labels = marketTrendData.map(d => d.month);

            // Price Chart
            new Chart(document.getElementById('price-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Price',
                        data: marketTrendData.map(d => d.avgPrice),
                        borderColor: 'rgba(37, 99, 235, 1)',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Foreclosure Chart
            new Chart(document.getElementById('foreclosure-chart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Foreclosures',
                        data: marketTrendData.map(d => d.foreclosures),
                        backgroundColor: 'rgba(220, 38, 38, 0.7)',
                        borderColor: 'rgba(220, 38, 38, 1)',
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }
        
        // --- CSV EXPORT ---
        function exportData() {
            const headers = ['Address', 'County', 'Current Value', 'Tax Delinquency', 'Mortgage Delinquency', 'Wholesale Price', 'ROI %'];
            const rows = filteredProperties.map(p => [
                `"${p.address}"`, p.county, p.currentValue, p.taxDelinquency, p.mortgageDelinquency, p.wholesalePrice, calculateROI(p)
            ].join(','));
            
            const csvContent = [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'ohio_property_analysis.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- EVENT LISTENERS ---
        Object.values(filterElements).forEach(el => el.addEventListener('change', updateFilters));
        exportBtn.addEventListener('click', exportData);
        tableBody.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-details-btn')) {
                const id = parseInt(e.target.dataset.id);
                showModal(id);
            }
        });
        modalOverlay.addEventListener('click', (e) => {
            if(e.target === modalOverlay) {
                hideModal();
            }
        });


        // --- INITIALIZATION ---
        setupCharts();
        updateFilters(); // Initial render
    });
    </script>
</body>
</html>
